create or replace PROCEDURE CREAR_TRIGGERS AS

Tcoderror NUMBER;
Ttexterror VARCHAR2(100);
PLSQLBLOCK VARCHAR2(10000);

BEGIN

FOR TABLA IN (SELECT TABLE_NAME FROM USER_TABLES WHERE TABLE_NAME LIKE 'INVERSIONES_%')
LOOP

    DBMS_OUTPUT.PUT_LINE('EMPRESA: ' || TABLA.table_name);    

    PLSQLBLOCK :='
    CREATE OR REPLACE TRIGGER TRIG_'|| TABLA.TABLE_NAME || ' AFTER INSERT ON ' || TABLA.TABLE_NAME || '
    FOR EACH ROW
    DECLARE

        CONTADOR NUMBER := 0;

    BEGIN

        SELECT COUNT(*) INTO CONTADOR FROM SUMAEMPRESA WHERE NOMBREE = ' || CONCAT(CONCAT('''',TABLA.TABLE_NAME),'''') || ';

        IF (CONTADOR = 0) THEN

            INSERT INTO SUMAEMPRESA VALUES(' || CHR(39) || TABLA.TABLE_NAME || CHR(39) || ',:new.cantidad);

        ELSE

            UPDATE SUMAEMPRESA SET CANTIDAD = CANTIDAD + :NEW.CANTIDAD WHERE NOMBREE = ' || CONCAT(CONCAT('''',TABLA.TABLE_NAME),'''') || ';

        END IF;

    END;
    ';

    EXECUTE IMMEDIATE PLSQLBLOCK;

END LOOP;

EXCEPTION

  WHEN OTHERS THEN

  Tcoderror:= SQLCODE;
  Ttexterror:= SUBSTR(SQLERRM,1, 100);
  DBMS_output.put_line('Sale por una excepcion: ' || Tcoderror ||   '  -- ' || Ttexterror );

END;